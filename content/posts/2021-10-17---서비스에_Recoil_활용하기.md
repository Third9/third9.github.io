---
title: "ì‹¤ ì„œë¹„ìŠ¤ì— Recoil í™œìš©í•˜ê¸°"
date: 2021-10-17T09:23:19.363Z
template: "post"
draft: false
slug: "/posts/recoil_í™œìš©í•˜ê¸°/"
category: "develop"
tags:
  - "recoil"
  - "react"
description: ìƒˆë¡œìš´ ì„œë¹„ìŠ¤ì— Recoilë¥¼ ì‚¬ìš©í•˜ë©´ì„œ ì•Œê²Œëœ êµ¬ì¡° ë° ë°©ë²•ì„ ì •ë¦¬
---

> ğŸ’¡ ì´ ê¸€ì€ ì˜ˆì „íŒ€ì—ì„œ ì„œë¹„ìŠ¤ë¥¼ ê°œë°œí•˜ëŠ” ì‹œì ì— Recoilì„ í™œìš©í–ˆë˜ ë‚´ìš©ì„ ì •ë¦¬í•œ ê¸€ì…ë‹ˆë‹¤.
> ì›ë˜ëŠ” 21ë…„ ì´ˆì— ì‘ì„±í•˜ë ¤ë˜ ê¸€ì´ ê³„ì† ë°€ë¦¬ë©´ì„œ ì´ì œì„œì•¼ ê¸€ì„ ì˜¬ë¦½ë‹ˆë‹¤.

ìƒˆë¡œìš´ ì„œë¹„ìŠ¤ë¥¼ ê°œë°œí•˜ë©´ì„œ ìƒíƒœê´€ë¦¬ì— Reduxê°€ ì•„ë‹Œ Recoilì„ ì ìš©í•˜ì˜€ë‹¤. Recoilì„ ì‚¬ìš©í•œ ì´ìœ ëŠ” ë‚®ì€ ëŸ¬ë‹ì»¤ë¸Œë¡œ Reactë¥¼ ì²˜ìŒ ì ‘í•˜ëŠ” ì‚¬ëŒë“¤ì—ê²Œ ìœ ë¦¬í•˜ê³ , ì—¬ëŸ¬ê°€ì§€ ëª¨ë“ˆ(redux-xxxx ë“±)ì„ ì„¤ì¹˜í•  í•„ìš”ì—†ì´ ë‹¨ í•˜ë‚˜ë¡œ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì ì´ë‹¤. ë¹„ë™ê¸°ë„ ì§€ì›í•œë‹¤.

> ğŸš¨ ë‹¤ë§Œ, Recoilì˜ ê²½ìš° ì•„ì§ ì‹¤í—˜ì ì¸ ë¶€ë¶„ì´ ë§ê¸°ì— ì‚¬ìš©í•˜ê¸°ì— ìˆì–´ì„œ ì„ í–‰ì ì¸ Test ë° ì ìš© ë²”ìœ„ ê²€í† ê°€ í•„ìš”í•˜ë‹¤ê³  ìƒê°í•œë‹¤.

## Recoil !! Atom? Selector?

ì¼ë‹¨ Recoilì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” reactì˜ componentê°€ í•¨ìˆ˜í˜•(Hook)ì„ì„ ì „ì œë¡œ í•œë‹¤.

ê·¸ë¦¬ê³  `atom`ê³¼ `selector`ì˜ ê°œë…ì— ëŒ€í•´ì„œë„ ì•Œì•„ì•¼í•˜ëŠ”ë°, `atom`ì€ reduxì˜ ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê²ƒê³¼ ê°™ì€ ê°œë…ìœ¼ë¡œ ìƒê°í•˜ë©´ ì‰½ë‹¤, `selector`ëŠ” ìˆœìˆ˜ functionìœ¼ë¡œ atom ë˜ëŠ” ë‹¤ë¥¸ selectorì˜ ê°’ì„ ë°›ì•„ì„œ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ê³ , í•´ë‹¹ ê°’ì´ update ë  ê²½ìš° í•´ë‹¹ selectorì˜ functionì„ ìˆ˜í–‰í•œë‹¤. selectorì—ì„œ atomì˜ ê°’ì„ ê°€ì ¸ì˜¤ê±°ë‚˜ ìˆ˜ì •í•˜ëŠ” ì‘ì—…ë„ ê°€ëŠ¥í•˜ë‹¤.

## Recoil ê¸°ë³¸ ì„¤ì •

ì„¤ì¹˜ë°©ë²•ì€ ì‹¬í”Œí•˜ê²Œ..

```bash
$ yarn add recoil
```

ì„¤ì¹˜ë¥¼ í–ˆìœ¼ë©´, Recoilì´ ì‘ë™í•  ìˆ˜ ìˆë„ë¡ ê¸°ë³¸ ì…‹íŒ…ì„ í•´ì£¼ì. reduxì²˜ëŸ¼ ë³µì¡í•œê²ƒ í•˜ë‚˜ì—†ì´ RecoilRootë§Œ ì¶”ê°€í•´ì£¼ë©´ Recoilì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ê¸°ë³¸ ì„¤ì •ì´ ì™„ë£Œ ëœë‹¤.

```tsx
// src/App.tsx
import React from "react";
import { RecoilRoot } from "recoil";

const App: React.FC = () => {
  return (
    <RecoilRoot>
      <div className="App"></div>
    </RecoilRoot>
  );
};
```

## Atom ì‚¬ìš©

atomì€ ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê¸°ë³¸ ë‹¨ìœ„ë¡œ ì•„ë˜ì™€ ê°™ì€ êµ¬ì¡°ë¥¼ ê°€ì§„ë‹¤.

### atom:

```tsx
// src/recoil/atom.ts
import { atom } from 'recoil';

export const stateAtom = atom({
  key: "@common/stateAtom"
  default: ''
})

// íƒ€ì…ì„ ëª…ì‹œì ìœ¼ë¡œ ì„ ì–¸í•˜ëŠ” ê²½ìš° í˜•ì‹
export const numArrayAtom = atom<number[]>({
  key: "@component/numArrayAtom",
  default: [10, 20],
});
```

ìœ„ì™€ ê°™ì€ í˜•íƒœë¡œ atomì„ ì„ ì–¸í•œë‹¤. ê° ìƒíƒœì˜ ê°’ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•´ì„œ ìœ ì¼ì„±ì„ ê°€ì§€ëŠ” keyë¥¼ ì„ ì–¸í•˜ê³ , defaultëŠ” ì´ë¦„ ê·¸ëŒ€ë¡œ ì²˜ìŒ atom ìƒíƒœê°’ì´ ê°€ì§ˆ ê¸°ë³¸ ê°’ì„ ì„ ì–¸í•œë‹¤. defaultëŠ” str, num, array ë“± íƒ€ì… ì„ ì–¸ì´ ê°€ëŠ¥í•˜ë‹¤. Atomì˜ ìì„¸í•œ ì‚¬ìš©ì„ ìœ„í•´ì„œëŠ” [Atom êµ¬ì¡°](https://recoiljs.org/docs/api-reference/core/atom)ë¥¼ ì°¸ì¡°í•˜ê¸¸ ë°”ë€ë‹¤

ì„ ì–¸í•œ atomì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” `useRecoilState` ë¥¼ ì´ìš©í•œë‹¤. ë°©ì‹ì€ `useState`ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒê³¼ ìœ ì‚¬í•˜ë‹¤.

```tsx
// src/App.tsx
// ì¼ë°˜ì ì¸ í˜•íƒœ
import { useRecoilState } from 'recoil';
import { stateAtom } from 'src/atom'

const App: React.FC = () => {
  const [state, setState] = useRecoilState(stateAtom);
  ...
}
```

ìœ„ì™€ ê°™ì€ ì¼ë°˜ì ì¸ í˜•íƒœ ì™¸ì—ë„ recoilì€ `useSetRecoilState`, `useRecoilValue` ì™€ ê°™ì€ ë‹¤ì–‘í•œ hookì„ ì§€ì›í•œë‹¤.

```tsx

import { useSetRecoilState, useRecoilValue } from 'recoil';
import { stateAtom } from 'src/atom'

/**
ìƒíƒœê°’ì„ ì‚¬ìš©í•  í•„ìš”ëŠ” ì—†ê³  Updateë§Œ í•˜ëŠ” ê²½ìš°
*/
const AComponent = () => {
  const setState = useSetRecoilState(stateAtom);
  ...
}

/**
ìƒíƒœê°’ì„ ì´ìš©í•˜ê¸°ë§Œ í•˜ëŠ” ê²½ìš°
*/
const BComponent = () => {
  const state = useRecoilValue(stateAtom);
  ...
}
```

ì„œë¹„ìŠ¤ë¥¼ ê°œë°œí•˜ë‹¤ ë³´ë©´ ë‹¤ì–‘í•œ ê²½ìš°ê°€ ë°œìƒí•œë‹¤. í•„ìš”ì¹˜ ì•ŠëŠ” ë³€ìˆ˜, í•¨ìˆ˜ë¥¼ ì½”ë“œìƒì— ë‘ëŠ” ê²½ìš°ì—ëŠ” Warnì´ ë°œìƒí•˜ê³ , ë¶ˆí•„ìš”í•œ ìì›ì˜ ì‚¬ìš©ì´ë¯€ë¡œ í•„ìš”ì— ë§ëŠ” Hookì„ ì´ìš©í•˜ë©´ ëœë‹¤. ìœ„ì—ì„œ ì‚¬ìš©í•œ hook ë§ê³ ë„ ë‹¤ì–‘í•œ hookì„ ì§€ì›í•œë‹¤.

### atom-Family:

ìƒíƒœê´€ë¦¬ë¥¼ í• ë•Œ ê° í™”ë©´ë³„ ê¸°ëŠ¥/ì„œë¹„ìŠ¤ ë“±ì—ì„œ ë™ì¼í•œ ìƒíƒœê°’ì„ ë‹¤ë¥´ê²Œ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤. ìœ ì‚¬í•œ ìƒíƒœì •ë³´ë¥¼ ìì›ë³„ë¡œ ê´€ë¦¬í•´ì•¼ í•˜ëŠ” ê²½ìš° Atomì—ì„œëŠ” ì•„ë˜ì™€ ê°™ì´ ì„ ì–¸í–ˆë‹¤.

```tsx
// src/recoil/atom.ts
import { atom } from 'recoil';

// BAD
export const atomOfA = atom({
  key: "@common/atomOfA"
  default: ''
})

export const atomOfB = atom({
  key: "@common/atomOfB"
  default: ''
})

export const atomOfC = atom({
  key: "@common/atomOfC"
  default: ''
})
```

ì´ë¦„ë§Œ ë°”ê¿”ì„œ ë³µì‚¬/ë¶™ì—¬ë„£ê¸°ë‹¤.. ë‹¤í–‰ì´ë„ recoilì—ì„œëŠ” `AtomFamily`ë¥¼ ì´ìš© í•´ì„œ ë¶ˆí•„ìš”í•¨ì„ í•´ê²°í•œë‹¤. ë§¤ìš° ê¹”ë”í•´ì§„ë‹¤.

```tsx
// src/recoil/atom.ts
import { atomFamily } from 'recoil';

// Good
export const resAtom = atomFamily({
  key: "@common/resAtom"
  default: ''
})

// src/App.tsx
import { useRecoilState } from 'recoil';
import { resAtom } from 'src/recoil/atom'

const App: React.FC = () => {
  const [state, setState] = useRecoilState(resAtom('{{resource}}'));

  ...
}
```

êµ¬ë¶„í•˜ë ¤ëŠ” ìì›ëª…ì¹­ì„ ìœ„ì™€ ê°™ì´ `{{resource}}`ë¡œ ì„ ì–¸í•˜ì—¬ atomì„ multiple í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

## Selector ì‚¬ìš©

selectorëŠ” ìˆœìˆ˜í•¨ìˆ˜ ë˜ëŠ” íŠ¹ì •í•œ ìƒíƒœë¥¼ ì „ë‹¬í•œë‹¤. atomì´ ë°ì´í„°ì˜ ìƒíƒœë¥¼ ê°€ì§„ë‹¤ë©´, selectorëŠ” í•¨ìˆ˜ë¥¼ í†µí•´ì„œ ê°€ê³µëœ ê²°ê³¼/ìƒíƒœë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.

selectorëŠ” get/set ë‚´ë¶€ í•¨ìˆ˜ë¥¼ ì§€ì›í•˜ëŠ”ë° ì´ ë‚´ë¶€ í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ Read/Updateê°€ ê°€ëŠ¥í•˜ë‹¤. ë˜í•œ ì¶”ê°€ ëª¨ë“ˆì—†ì´ë„ ë¹„ë™ê¸°ë¥¼ ì§€ì›í•œë‹¤.(selectorë„ atomê³¼ ë§ˆì°¬ê°€ì§€ë¡œ selectorFamilyê°€ ì¡´ì¬í•œë‹¤.)

### selector:

```tsx
// src/recoil/selector.ts
import { selector } from 'recoil';
import { stateAtom } from './atom';

export const stateSelector = selector({
  key: '@common/stateSelector',
  get: ({ get }) => {
    const state: string = get(stateAtom);
    return `Selector ${state}`
  },
});

// src/App.tsx
import { useRecoilValue } from 'recoil';
import { stateSelector } from 'src/recoil/selector'

const App: React.FC = () => {
  const state = useRecoilValue(stateSelector);

  ...
}
```

ìœ„ì˜ ì½”ë“œë¥¼ ë³´ë©´ get ë©”ì†Œë“œ ì•ˆì—ì„œ paramìœ¼ë¡œ `get` í•¨ìˆ˜ë¥¼ ë°›ëŠ”ê²ƒì„ ë³¼ ìˆ˜ ìˆëŠ”ë°, ì´ê²ƒì„ ì´ìš©í•´ì„œ ë‹¤ë¥¸ atomì˜ ìƒíƒœ ê°’ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤. read í˜•íƒœë¡œ selectorì—ì„œ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤ë©´ useRecoilValue ë§Œì„ ì‚¬ìš©í•´ë„ ëœë‹¤.

### selector: set()

```tsx
// src/recoil/selector.ts
import { selector } from 'recoil';
import { stateAtom } from './atom';

export const stateSelector = selector({
  key: '@common/stateSelector',
  get: ({ get }) => {
    // stateAtomì˜ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.
    const state: string = get(stateAtom);
    return `Selector ${state}`
  },
  set: ({ set }, params) => {
    const state: string = params.state;
    // stateAtomì— paramìœ¼ë¡œ ì „ë‹¬ë°›ì€ state ê°’ì„ ë“±ë¡í•œë‹¤.
    set(stateAtom, state);
  },
});

// src/App.tsx
import { useRecoilState } from 'recoil';
import { stateSelector } from 'src/recoil/selector'

const App: React.FC = () => {
  const [state, setState] = useRecoilState(stateSelector);

  ...
}
```

selectorì—ì„œ setì„ ì‚¬ìš©í•  ê²½ìš° useRecoilStateë¥¼ ì´ìš©í•´ì„œ ì²˜ë¦¬ ê°€ëŠ¥í•˜ë‹¤. setStateë¥¼ í˜¸ì¶œ í• ë•Œ stateSelectorë‚´ë¶€ì˜ `set`í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤.

### selector: Async/Await

ê¸°ë³¸ ë°©ì‹ê³¼ í¬ê²Œ ë‹¤ë¥´ì§€ ì•Šë‹¤. ê·¸ì € async/awaitë¥¼ ì„ ì–¸í•¨ìœ¼ë¡œì¨ ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤.

```tsx
// src/recoil/selector.ts
import { selector } from "recoil";

export const itemSelector = selector({
  key: "@common/itemSelector",
  get: async ({ get }) => {
    const res: object = await fetch("url");
    const data: any = res.json(); // anyëŠ” ìì œí•©ì‹œë‹¤..
    return data;
  },
});
```

ìœ„ì™€ ê°™ì´ ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬í•  ê²½ìš° ìˆ˜í–‰ê³¼ì • ë™ì•ˆì˜ ë”œë ˆì´ ì²˜ë¦¬ë°©ì‹ì€ `React.Suspense`ë¥¼ ì´ìš©í•˜ëŠ” ë°©ì‹ê³¼ `useRecoilValueLoadable()`ë¥¼ ì´ìš©í•˜ëŠ” ë°©ì‹ì´ ìˆë‹¤. Loadableì„ ì´ìš©í•´ì„œ ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤. (React.Suspense ë°©ì‹ì€ recoilì´ ì•„ë‹ˆì–´ë„ ë‹¤ë¥¸ê³³ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ê³¼ ìœ ì‚¬í•˜ë‹¤.)

```tsx
// src/App.tsx
import React from 'react';
import { useRecoilValueLoadable } from 'recoil';
import { itemSelector } from 'src/selector'

const App: React.FC = () => {
  const itemLoader = useRecoilValueLoadable(itemSelector);
  let state: string = itemLoader.state;

  const renderData = () => {
    switch (state) {
      case 'hasValue':
        return (
          <div className="itemList">
            {itemLoader.contents.map((item) => {
              return <div className="item">{item}</div>})}
          </div>
        )
      case 'loading':
        return <div>...is Loading</div>;
      case 'hasError':
        return <div>Error</div>;
      }
    }
    ...
}
```

asyncë¡œ êµ¬í˜„ëœ selectorë¥¼ useRecoilValueLoadable()ë¥¼ ì´ìš©í•˜ì—¬ í˜¸ì¶œí•˜ë©´ í•´ë‹¹ ê°ì²´ëŠ” stateì™€ contents ë‘ê°œì˜ ìƒíƒœë¥¼ ê°€ì§„ë‹¤. stateëŠ” `hasValue, loading, hasError` 3ê°€ì§€ì˜ ìƒíƒœë¥¼ ê°€ì§€ëŠ”ë° ``contents`ì˜ ê°’ì€ stateê°€`hasValue` ì¼ë•Œë§Œ ê°€ì§„ë‹¤.

### selectorFamily:

selectorë„ atomê³¼ ê°™ì´ familyê°€ ì¡´ì¬í•œë‹¤. ì½”ë“œìƒì˜ resourceëŠ” selectorFamily ì„ ì–¸ì‹œ ë„£ì–´ì£¼ëŠ” resource ê°’ì´ë‹¤.

```tsx
// src/recoil/selector.ts
import { selectorFamily } from "recoil";
import { selectedItemAtomF } from "src/atom";

export const itemSelectorF = selectorFamily({
  key: "@common/itemSelectorF",
  get: resource => async ({ get }) => {
    const item = get(selectedItemAtomF(resource));
    return { resource, item };
  },
});
```

## ETC: atom.effect

ì‹œí—˜ì ì¸ ê¸°ëŠ¥ ì¤‘ atomì— effectë¼ëŠ” methodê°€ ìˆë‹¤. useEffectì™€ ê°™ì´ ìƒíƒœê°€ ì´ˆê¸°í™”/ë³€ê²½ ë˜ì—ˆì„ë•Œ ì„ ì–¸í•œ functionì„ ìˆœì°¨ì ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ”ë° ë‹¤ë¥¸ì ì€ ìƒíƒœê°€ atom ë³¸ì¸ì´ë¼ëŠ” ì ì´ë‹¤. í•´ë‹¹ ê¸°ëŠ¥ì€ ì•„ì§ unstableí•˜ê¸°ì— ì‚¬ìš©ì— ìˆì–´ì„œ ì£¼ì˜ë¥¼ ìš”í•œë‹¤. ë‹¤ë§Œ, ê¸°ëŠ¥ì ì¸ ë¶€ë¶„ì— ìˆì–´ì„œëŠ” í™œìš©ë„ê°€ ë†’ë‹¤ê³  ìƒê°í•˜ì—¬ ê°™ì´ ì„¤ëª…í•œë‹¤.

```tsx
// src/recoil/atom.ts
import { atom } from 'recoil';

export const stateAtom = atom({
  key: "@common/stateAtom"
  default: '',
  effects_UNSTABLE: [
    ({ setSelf, onSet }) => {
      onSet((newValue, oldValue) => {
        // ìˆ˜í–‰í•  ì½”ë“œ ì…ë ¥
        ...
        // atom ìì‹ ì„ ìˆ˜ì •í•  ê²½ìš°
        setSelf(...)
      }
    },
    ({ setSelf, onSet }) => {
      onSet((newValue, oldValue) => {
        // ìˆ˜í–‰í•  ì½”ë“œ ì…ë ¥
        ...
        // atom ìì‹ ì„ ìˆ˜ì •í•  ê²½ìš°
        setSelf(...)
      }
    }
  ]
})
```

effectì˜ ê²½ìš° ì‚¬ìš©ì„ ìœ„í•´ì„œëŠ” effects_UNSTABLE ì´ë¼ê³  ì„ ì–¸í•˜ì—¬ì•¼ í•œë‹¤. ê³µì‹ ë¬¸ì„œë¥¼ ë³´ë©´ í•´ë‹¹ ê¸°ëŠ¥ì„ ì´ìš©í•´ì„œ atomì˜ log, history ê´€ë¦¬ ë“± ë‹¤ì–‘í•œ ì—­í• ì„ í•  ìˆ˜ ìˆë‹¤. ì„ ì–¸í•˜ëŠ” functionì˜ ê²½ìš°ë„ async/awaitë¥¼ ì´ìš©í•œ ë¹„ë™ê¸°ë¥¼ ì§€ì›í•œë‹¤. ë” ìì„¸í•œ ë‚´ìš© ë° ì‚¬ìš©ë²•ì€ [ê³µì‹ë¬¸ì„œ](https://recoiljs.org/docs/guides/atom-effects)ë¥¼ ì°¸ì¡° ë°”ë€ë‹¤.

> ê¸€ì„ ì“°ëŠ” ì‚¬ì´ì— ë²„ì „ì—…ì´ ë§ì´ ë˜ì—ˆë‹¤... ìƒˆë¡­ê²Œ ì¶”ê°€ëœ ê¸°ëŠ¥ë“¤ì— ëŒ€í•´ì„œëŠ” ë§ì€ ë¶„ë“¤ì´ ê¸€ì„ ì½ì–´ì£¼ì‹œë©´ ì¶”ê°€ë¡œ ì •ë¦¬í•˜ê² ìŠµë‹ˆë‹¤.
